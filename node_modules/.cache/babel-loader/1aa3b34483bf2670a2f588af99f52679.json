{"remainingRequest":"C:\\Users\\r7000\\Desktop\\pagepro\\lsying\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\r7000\\Desktop\\pagepro\\lsying\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!C:\\Users\\r7000\\Desktop\\pagepro\\lsying\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\r7000\\Desktop\\pagepro\\lsying\\src\\views\\deviceoperate\\list\\components\\dialog.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\r7000\\Desktop\\pagepro\\lsying\\src\\views\\deviceoperate\\list\\components\\dialog.vue","mtime":1609980881476},{"path":"C:\\Users\\r7000\\Desktop\\pagepro\\lsying\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\r7000\\Desktop\\pagepro\\lsying\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"C:\\Users\\r7000\\Desktop\\pagepro\\lsying\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\r7000\\Desktop\\pagepro\\lsying\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["\"use strict\";\n\nvar _interopRequireDefault = require(\"C:/Users/r7000/Desktop/pagepro/lsying/node_modules/@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nrequire(\"core-js/modules/es6.set\");\n\nrequire(\"core-js/modules/es6.string.iterator\");\n\nrequire(\"core-js/modules/es6.array.from\");\n\nrequire(\"core-js/modules/web.dom.iterable\");\n\nrequire(\"core-js/modules/es6.array.find\");\n\nrequire(\"core-js/modules/es6.regexp.split\");\n\nrequire(\"core-js/modules/es6.function.name\");\n\nrequire(\"core-js/modules/es6.number.constructor\");\n\nvar _productApi = _interopRequireDefault(require(\"@/api/product/product-api\"));\n\nvar _userDialog = _interopRequireDefault(require(\"./userDialog\"));\n\nvar _axios = _interopRequireDefault(require(\"axios\"));\n\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nvar _default = {\n  name: \"DeviceDialog\",\n  components: {\n    UserDialog: _userDialog.default\n  },\n  props: {\n    // detail: 详细页面，add: 添加页面，update：编辑页面\n    isDetail: {\n      type: Boolean,\n      default: false\n    },\n    isAdd: {\n      type: Boolean,\n      default: false\n    },\n    isUpdate: {\n      type: Boolean,\n      default: false\n    },\n    isCopy: {\n      type: Boolean,\n      default: false\n    }\n  },\n  data: function data() {\n    return {\n      dialogVisible: false,\n      dialogTitle: null,\n      form: {\n        id: 0,\n        did: 0,\n        name: \"\",\n        code: \"\",\n        price: \"\",\n        firstCategory: \"\",\n        secondaryCategory: \"\",\n        threeCategory: \"\",\n        brand: \"\",\n        address: \"\",\n        deliveryMethod: \"\",\n        freightPayer: \"\",\n        deliveryDate: \"\",\n        onstate: \"\",\n        shelfStatus: 0,\n        piclist: \"\",\n        description: \"\",\n        createTime: \"\",\n        updateTime: \"\",\n        deleted: 0,\n        commoditynum: 0,\n        upend: '30',\n        upstart: '',\n        leftend: '',\n        leftstart: ''\n      },\n      updateId: null,\n      rules: {\n        name: [{\n          required: true,\n          message: \"请输入商品名称\",\n          trigger: \"blur\"\n        } // { min: 4, max: 16, message: '长度在 2 到 10 个字符', trigger: 'blur' }\n        ],\n        state: [{\n          required: true,\n          message: '请选择随机字符',\n          trigger: 'change'\n        }],\n        shelfStatus: [{\n          required: true,\n          message: '请选择上下架状态',\n          trigger: 'change'\n        }],\n        price: [{\n          required: true,\n          message: '请输入价格',\n          trigger: 'change'\n        }],\n        firstCategory: [{\n          required: true,\n          message: '请输入一级类目',\n          trigger: 'change'\n        }],\n        secondaryCategory: [{\n          required: true,\n          message: '请输入二级类目',\n          trigger: 'change'\n        }],\n        threeCategory: [{\n          required: true,\n          message: '请输入三级类目',\n          trigger: 'change'\n        }],\n        // brand: [\n        //   { required: true, message: '请输入品牌', trigger: 'change' }\n        // ],\n        address: [{\n          required: true,\n          message: '请输入发货地址',\n          trigger: 'change'\n        }],\n        deliveryMethod: [{\n          required: true,\n          message: '请选择发货方式',\n          trigger: 'change'\n        }],\n        freightPayer: [{\n          required: true,\n          message: '请选择运费承担人',\n          trigger: 'change'\n        }],\n        deliveryDate: [{\n          required: true,\n          message: '请选择发货日期',\n          trigger: 'change'\n        }],\n        onstate: [{\n          required: true,\n          message: '请选择新旧程度',\n          trigger: 'change'\n        }],\n        description: [{\n          required: true,\n          message: '请输入商品描述',\n          trigger: 'change'\n        }],\n        leftstart: [{\n          required: true,\n          message: '请输入距左侧随机数开始',\n          trigger: 'change'\n        }],\n        leftend: [{\n          required: true,\n          message: '请输入距左侧随机数结束',\n          trigger: 'change'\n        }],\n        upstart: [{\n          required: true,\n          message: '请输入距上侧随机数开始',\n          trigger: 'change'\n        }],\n        upend: [{\n          required: true,\n          message: '请输入距上侧随机数结束',\n          trigger: 'change'\n        }],\n        piclist: [{\n          required: true,\n          message: '请上传图片',\n          trigger: 'change'\n        }]\n      },\n      addressList: [{\n        value: 1,\n        label: \"東京都\"\n      }, {\n        value: 2,\n        label: \"埼玉県\"\n      }, {\n        value: 3,\n        label: \"千葉県\"\n      }, {\n        value: 4,\n        label: \"神奈川県\"\n      }, {\n        value: 5,\n        label: \"群馬県\"\n      }, {\n        value: 6,\n        label: \"大阪府\"\n      }, {\n        value: 7,\n        label: \"未定\"\n      }],\n      // img\n      fileList: [],\n      formData: {},\n      origin: window.location.protocol + \"//\" + window.location.hostname + ':8888',\n      // 拖拽\n      dragObj: {\n        index: 0,\n        item: {}\n      },\n      dropObj: {\n        index: 0,\n        item: {}\n      },\n      // 目录list\n      firstCategoryList: [],\n      secondaryCategoryList: [],\n      threeCategoryList: []\n    };\n  },\n  computed: {},\n  created: function created() {},\n  methods: {\n    handle: function handle(id) {\n      this.flushCategoryList(); // alert(111)\n\n      if (this.isDetail) {\n        console.log(\"detail...\" + id);\n        this.rules = null;\n        this.dialogTitle = \"商品详情\";\n        this.getRoleDetail(id);\n      } else if (this.isAdd) {\n        console.log(\"add...\");\n        this.dialogTitle = \"新增商品\";\n      } else if (this.isUpdate) {\n        console.log(\"update...\");\n        this.dialogTitle = \"修改商品\";\n        this.updateId = id;\n        this.getRoleDetail(id);\n      } else if (this.isCopy) {\n        console.log(\"copy...\");\n        this.dialogTitle = \"修改商品\";\n        this.updateId = id;\n        this.getRoleDetail(id);\n      }\n\n      this.dialogVisible = true;\n    },\n    submitAddForm: function submitAddForm() {\n      var _this = this;\n\n      this.$refs.DeviceDialogForm.validate(function (valid) {\n        if (Number(_this.form.leftstart) > Number(_this.form.leftend) || Number(_this.form.upstart) > Number(_this.form.upend)) {\n          _this.$message({\n            type: 'error',\n            message: \"\\u6DFB\\u52A0\\u5931\\u8D25\\uFF0C\\u622A\\u56FE\\u8303\\u56F4\\u5F00\\u59CB\\u6570\\u5FC5\\u987B\\u5927\\u4E8E\\u7ED3\\u675F\\u6570\"\n          });\n\n          return;\n        }\n\n        if (_this.form.name.length > 37) {\n          _this.$message({\n            type: 'error',\n            message: \"\\u4FEE\\u6539\\u5931\\u8D25\\uFF0C\\u5546\\u54C1\\u540D\\u8D85\\u51FA\\u5B57\\u6570\"\n          });\n\n          return;\n        }\n\n        if (_this.form.description.length > 1000) {\n          _this.$message({\n            type: 'error',\n            message: \"\\u4FEE\\u6539\\u5931\\u8D25\\uFF0C\\u5546\\u54C1\\u63CF\\u8FF0\\u8D85\\u51FA\\u5B57\\u6570\"\n          });\n\n          return;\n        }\n\n        if (valid) {\n          console.log(\"submit!\");\n\n          _this.addRole(); // this.$emit(\"getList\")\n\n        } else {\n          console.log(\"error submit!!\");\n          return false;\n        }\n      });\n    },\n    submitUpdateForm: function submitUpdateForm() {\n      var _this2 = this;\n\n      this.$refs.DeviceDialogForm.validate(function (valid) {\n        if (Number(_this2.form.leftstart) > Number(_this2.form.leftend) || Number(_this2.form.upstart) > Number(_this2.form.upend)) {\n          _this2.$message({\n            type: 'error',\n            message: \"\\u4FEE\\u6539\\u5931\\u8D25\\uFF0C\\u622A\\u56FE\\u8303\\u56F4\\u5F00\\u59CB\\u6570\\u5FC5\\u987B\\u5927\\u4E8E\\u7ED3\\u675F\\u6570\"\n          });\n\n          return;\n        }\n\n        if (_this2.form.name.length > 37) {\n          _this2.$message({\n            type: 'error',\n            message: \"\\u4FEE\\u6539\\u5931\\u8D25\\uFF0C\\u5546\\u54C1\\u540D\\u8D85\\u51FA\\u5B57\\u6570\"\n          });\n\n          return;\n        }\n\n        if (_this2.form.description.length > 1000) {\n          _this2.$message({\n            type: 'error',\n            message: \"\\u4FEE\\u6539\\u5931\\u8D25\\uFF0C\\u5546\\u54C1\\u63CF\\u8FF0\\u8D85\\u51FA\\u5B57\\u6570\"\n          });\n\n          return;\n        }\n\n        if (valid) {\n          console.log(\"submit!\");\n\n          _this2.updateRole(); // this.$emit(\"getList\")\n\n        } else {\n          console.log(\"error submit!!\");\n          return false;\n        }\n      });\n    },\n    submitCopyForm: function submitCopyForm() {\n      var _this3 = this;\n\n      this.$refs.DeviceDialogForm.validate(function (valid) {\n        if (valid) {\n          var tempForm = JSON.parse(JSON.stringify(_this3.form));\n\n          _this3.$emit(\"copy\", tempForm);\n\n          _this3.restForm();\n        } else {\n          console.log(\"error submit!!\");\n          return false;\n        }\n      });\n    },\n    getRoleDetail: function getRoleDetail(id) {\n      var _this4 = this;\n\n      _productApi.default.detail(id).then(function (response) {\n        if (response.code === 200) {\n          _this4.form = response.data; // this.$set(this.form, 'upend', 30)\n          // this.$set(this.form, 'upstart', 10)\n          // this.$set(this.form, 'leftend', 30)\n          // this.$set(this.form, 'leftstart', 10)\n\n          if (_this4.form.piclist) {\n            _this4.fileList = _this4.form.piclist.split(';');\n          }\n        }\n      });\n    },\n    addRole: function addRole() {\n      var _this5 = this;\n\n      this.form.deviceId = this.$parent.deviceId;\n      this.form.did = this.$parent.deviceId;\n      var addParam = this.form;\n\n      _productApi.default.add(addParam).then(function (response) {\n        if (response.code === 200) {\n          _this5.saveCategory();\n\n          _this5.restForm();\n\n          _this5.$message({\n            message: \"保存商品成功\",\n            type: \"success\"\n          });\n\n          _this5.$emit(\"change\");\n        }\n      });\n    },\n    updateRole: function updateRole() {\n      var _this6 = this;\n\n      _productApi.default.update(this.form).then(function (response) {\n        if (response.code === 200) {\n          _this6.saveCategory();\n\n          _this6.restForm();\n\n          _this6.$message({\n            message: \"修改商品成功\",\n            type: \"success\"\n          });\n\n          _this6.$emit(\"change\");\n        }\n      });\n    },\n    restForm: function restForm() {\n      this.$refs.DeviceDialogForm.resetFields();\n      this.dialogVisible = false;\n    },\n    handOpenUserDialog: function handOpenUserDialog() {\n      var _this7 = this;\n\n      this.$nextTick(function () {\n        _this7.$refs.userDialog.handle();\n      });\n    },\n    handleSave: function handleSave(row) {},\n    // handle随机字符串\n    handleRamdenChange: function handleRamdenChange(v) {\n      function randomString(e) {\n        e = e || 2;\n        var t = \"ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678!@#$%^&*<>/*-+()=~.;|[]{}\";\n        var a = t.length;\n        var n = \"\";\n\n        for (var i = 0; i < e; i++) {\n          n += t.charAt(Math.floor(Math.random() * a));\n        }\n\n        return n;\n      }\n\n      if (v === 1) {\n        do {\n          var rstr = randomString(2);\n        } while (!isNaN(rstr));\n\n        this.form.name = rstr + this.form.name;\n      }\n\n      if (v === 2) {\n        do {\n          var rstrs = randomString(2);\n        } while (!isNaN(rstrs));\n\n        this.form.name = this.form.name + rstrs;\n      } // if (v === 3) {\n      //   this.form.name = \"\";\n      // }\n\n    },\n    // 上传图片成功\n    // on-change：文件状态改变时的钩子，添加文件、上传成功和上传失败时都会被调用\n    fileChange: function fileChange(file, fileList) {\n      this.fileList = fileList;\n      var existFile = fileList.slice(0, fileList.length - 1).find(function (f) {\n        return f.name === file.name;\n      }); // 如果文件名重复\n\n      if (existFile) {\n        this.$message.error(\"当前文件已经存在!\");\n        fileList.pop();\n      }\n    },\n    // on-remove：文件列表移除文件时的钩子\n    removeFile: function removeFile(file, fileList) {\n      this.fileList = fileList; // 此处fileList为删除文件后，剩余的文件\n    },\n    // 保存上传\n    saveFile: function saveFile() {\n      var _this8 = this;\n\n      if (Number(this.form.leftstart) > Number(this.form.leftend) || Number(this.form.upstart) > Number(this.form.upend)) {\n        this.$message({\n          type: 'error',\n          message: \"\\u4E0A\\u4F20\\u5931\\u8D25\\uFF0C\\u5F00\\u59CB\\u6570\\u5FC5\\u987B\\u5927\\u4E8E\\u7ED3\\u675F\\u6570\"\n        });\n        return;\n      }\n\n      var uploadFiles = this.$refs.upload.uploadFiles;\n      var formData = new FormData();\n      formData.append(\"token\", JSON.parse(sessionStorage.userInfo).token);\n      formData.append(\"deviceid\", this.$parent.deviceId);\n      formData.append(\"did\", this.$parent.deviceId);\n      formData.append(\"leftend\", this.form.leftend);\n      formData.append(\"leftstart\", this.form.leftstart);\n      formData.append(\"upend\", this.form.upend);\n      formData.append(\"upstart\", this.form.upstart);\n      uploadFiles.forEach(function (item) {\n        formData.append(\"files\", item.raw);\n      }); // 此时所有的钩子已经执行完了fileData 中存的是通过校验的数据\n\n      _productApi.default.upload(formData).then(function (res) {\n        var temp = res.data.data.map(function (item) {\n          return item.split(\"/resource/\")[1];\n        });\n        _this8.form.piclist = temp.join(\";\");\n      }).catch(function (err) {\n        console.log(err, \"---------\");\n      }); // this.subFile(formData).then(res => {\n      //   // this.diaFile = false\n      //   // -----可写保存成功后执行的操作，此处省略\n      //   this.fileList = []// 清空\n      // }).catch((res) => {\n      // // -----可写保存失败后执行的操作，此处省略\n      //   // this.diaFile = false\n      // })\n\n    },\n    // 取消\n    cancelUploadFile: function cancelUploadFile() {\n      // this.diaFile = false//关闭弹窗\n      this.importList = {\n        // 清空表单其他项\n        sysName: \"\",\n        // 系统名称\n        resName: \"\",\n        // 资源名称\n        resItemName: \"\",\n        // 资源项名称\n        fileList: \"\" // 文件名列表\n\n      };\n      this.fileList = [];\n    },\n    subFile: function subFile(data) {\n      return (0, _axios.default)({\n        // todo 换成相对ip地址\n        url: \"http://116.62.196.62:8888/api/commodity/upload\",\n        method: \"post\",\n        data: data,\n        headers: {\n          \"Content-Type\": \"application/x-www-form-urlencoded\"\n        }\n      });\n    },\n    // 删除图片\n    handleDeleteImg: function handleDeleteImg(item, index) {\n      this.fileList.splice(index, 1);\n      var arr = this.form.piclist.split(';');\n      arr.splice(index, 1);\n      this.form.piclist = arr.join(';'); // this.form.piclist.split(';').splice(index, 1).join(';')\n      // this.form.piclist = this.fileList.join(\";\");\n    },\n    // 拖拽\n    handleDragStart: function handleDragStart($event, index, item) {\n      this.dragObj = {\n        index: index,\n        item: item\n      };\n    },\n    handleDragOver: function handleDragOver($event, index, item) {\n      $event.preventDefault(); // console.log('handleDragOver', $event, index, item)\n    },\n    handleDrop: function handleDrop($event, index, item) {\n      this.dropObj = {\n        index: index,\n        item: item\n      };\n      var arr = this.form.piclist.split(';');\n      arr[this.dragObj.index] = this.dropObj.item;\n      arr[this.dropObj.index] = this.dragObj.item;\n      this.form.piclist = arr.join(';');\n    },\n    // 三级目录缓存功能\n    saveCategory: function saveCategory() {\n      // 1\n      if (!localStorage.firstCategoryList) {\n        localStorage.firstCategoryList = [];\n      }\n\n      var arr1 = localStorage.firstCategoryList.split(',');\n      arr1.push(this.form.firstCategory);\n      localStorage.firstCategoryList = Array.from(new Set(arr1)); // 2\n\n      if (!localStorage.secondaryCategoryList) {\n        localStorage.secondaryCategoryList = [];\n      }\n\n      var arr2 = localStorage.secondaryCategoryList.split(',');\n      arr2.push(this.form.secondaryCategory);\n      localStorage.secondaryCategoryList = Array.from(new Set(arr2));\n      console.log(arr2); // 3\n\n      if (!localStorage.threeCategoryList) {\n        localStorage.threeCategoryList = [];\n      }\n\n      var arr3 = localStorage.threeCategoryList.split(',');\n      arr3.push(this.form.threeCategory);\n      localStorage.threeCategoryList = Array.from(new Set(arr3));\n      console.log(arr3);\n    },\n    // 清空三级目录缓存\n    clearCategory: function clearCategory(category) {\n      localStorage.removeItem(category);\n      this.flushCategoryList();\n      this.$message.success('缓存清除成功');\n    },\n    // 刷新三级List\n    flushCategoryList: function flushCategoryList() {\n      if (localStorage.firstCategoryList) {\n        this.firstCategoryList = localStorage.firstCategoryList.split(',').filter(function (item) {\n          if (item) return item;\n        });\n      } else {\n        this.firstCategoryList = [];\n      }\n\n      if (localStorage.secondaryCategoryList) {\n        this.secondaryCategoryList = localStorage.secondaryCategoryList.split(',').filter(function (item) {\n          if (item) return item;\n        });\n      } else {\n        this.secondaryCategoryList = [];\n      }\n\n      if (localStorage.threeCategoryList) {\n        this.threeCategoryList = localStorage.threeCategoryList.split(',').filter(function (item) {\n          if (item) return item;\n        });\n      } else {\n        this.threeCategoryList = [];\n      }\n    }\n  }\n};\nexports.default = _default;",null]}