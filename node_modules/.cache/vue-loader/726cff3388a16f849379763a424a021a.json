{"remainingRequest":"C:\\Users\\r7000\\Desktop\\pagepro\\lsying\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\r7000\\Desktop\\pagepro\\lsying\\src\\views\\system\\sys-role\\sys-role-menu.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\r7000\\Desktop\\pagepro\\lsying\\src\\views\\system\\sys-role\\sys-role-menu.vue","mtime":1609569561000},{"path":"C:\\Users\\r7000\\Desktop\\pagepro\\lsying\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"C:\\Users\\r7000\\Desktop\\pagepro\\lsying\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\r7000\\Desktop\\pagepro\\lsying\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport sysPermissionApi from '@/api/system/sys-permission-api'\nimport sysRoleApi from '../../../api/system/sys-role-api'\n\nexport default {\n  name: 'SysRoleMenu',\n  data() {\n    return {\n      filterText: '',\n      data: null,\n      checkedKeys: null,\n      roleId: null,\n      roleName: null,\n      errorMessage: null\n    }\n  },\n  created() {\n    const roleId = this.$route.params && this.$route.params.id;\n    console.log(roleId)\n    this.roleId = roleId;\n    this.getRole(roleId);\n  },\n  watch: {\n    filterText(val) {\n      this.$refs.tree.filter(val);\n    }\n  },\n  methods: {\n    getMenus() {\n      sysPermissionApi.getAllMenuTree().then(response => {\n        this.data = response.data;\n      })\n    },\n    filterNode(value, data) {\n      if (!value) return true;\n      return data.name.indexOf(value) !== -1 || data.remark.indexOf(value) !== -1;\n    },\n    getRole(roleId) {\n      sysRoleApi.detail(roleId).then(response => {\n        if (response.code === 200) {\n          this.roleName = response.data.name;\n          this.loadData();\n        } else {\n          this.errorMessage = response.message;\n        }\n      })\n    },\n    loadData() {\n      // 获取所有菜单\n      this.getMenus();\n      // 根据角色获取菜单\n      this.getMenuIdsByRoleId(this.roleId);\n    },\n    getMenuIdsByRoleId(roleId) {\n      sysPermissionApi.getMenuIdsByRoleId(roleId).then(response => {\n        this.checkedKeys = response.data;\n      })\n    },\n    handleClose() {\n      const view = this.$store.state.tagsView.visitedViews.find(item => {\n        return item.name === 'sysRoleMenu';\n      });\n      this.$store.dispatch('tagsView/delView', view).then(({ visitedViews }) => {\n        if (visitedViews) {\n          const latestView = visitedViews.slice(-1)[0];\n          this.$router.push(latestView.fullPath);\n        }\n      })\n    },\n    handleSave() {\n      const ids = this.$refs.tree.getCheckedKeys();\n      console.log(ids);\n      const param = {\n        roleId: this.roleId,\n        permissionIds: ids\n      }\n      sysRoleApi.updateSysRolePermission(param).then(response => {\n        console.log(response.data);\n        if (response.code === 200) {\n          this.$message({\n            message: '保存成功',\n            type: 'success'\n          });\n          this.loadData();\n        }\n      });\n    }\n  }\n};\n",null]}