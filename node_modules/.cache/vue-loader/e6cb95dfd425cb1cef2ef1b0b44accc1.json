{"remainingRequest":"D:\\Desktop\\pagepro\\lsying\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\Desktop\\pagepro\\lsying\\src\\views\\system\\sys-user\\components\\sys-user.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\Desktop\\pagepro\\lsying\\src\\views\\system\\sys-user\\components\\sys-user.vue","mtime":1609569561000},{"path":"D:\\Desktop\\pagepro\\lsying\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"D:\\Desktop\\pagepro\\lsying\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\Desktop\\pagepro\\lsying\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport sysUserApi from '@/api/system/sys-user-api'\nimport sysDepartmentApi from '@/api/system/sys-department-api'\nimport sysRoleApi from '@/api/system/sys-role-api'\nimport TreeSelect from '@/components/TreeSelect'\n\nexport default {\n  name: 'SysUser',\n  components: { TreeSelect },\n  props: {\n    // detail: 详细页面，add: 添加页面，update：编辑页面\n    isDetail: {\n      type: Boolean,\n      default: false\n    },\n    isAdd: {\n      type: Boolean,\n      default: false\n    },\n    isUpdate: {\n      type: Boolean,\n      default: false\n    }\n  },\n  data() {\n    return {\n      dialogVisible: false,\n      dialogTitle: null,\n      form: {\n        id: null,\n        username: null,\n        nickname: null,\n        phone: null,\n        gender: null,\n        head: null,\n        remark: null,\n        state: 1,\n        departmentId: null,\n        roleId: null,\n        deleted: null\n      },\n      departmentName: null,\n      updateId: null,\n      departmentOptions: null,\n      roleOptions: null,\n      treeSelectData: null,\n      rules: {\n        username: [\n          { required: true, message: '请输入用户账号', trigger: 'blur' },\n          { min: 4, max: 16, message: '长度在 4 到 16 个字符', trigger: 'blur' }\n        ],\n        nickname: [\n          { required: true, message: '请输入用户名称', trigger: 'blur' },\n          { min: 2, max: 10, message: '长度在 2 到 10 个字符', trigger: 'blur' }\n        ],\n        phone: [\n          { required: true, message: '请输入手机号码', trigger: 'blur' },\n          { min: 11, max: 11, message: '长度11个字符', trigger: 'blur' }\n        ],\n        departmentId: [\n          { required: true, message: '请选择部门', trigger: 'change' }\n        ],\n        roleId: [\n          { required: true, message: '请选择角色', trigger: 'change' }\n        ],\n        state: [\n          { required: true, message: '请选择状态', trigger: 'change' }\n        ],\n        remark: [\n          { max: 100, message: '长度100个字符', trigger: 'blur' }\n        ]\n      }\n    }\n  },\n  computed: {},\n  created() {\n\n  },\n  mounted() {\n\n  },\n  methods: {\n    handle(id) {\n      if (this.isDetail) {\n        this.rules = null;\n        this.dialogTitle = '系统用户详情';\n        this.getUserDetail(id);\n      } else if (this.isAdd) {\n        this.dialogTitle = '新增系统用户';\n        this.getDepartmentTree()\n        this.getRoleList()\n      } else if (this.isUpdate) {\n        this.dialogTitle = '修改系统用户';\n        this.updateId = id;\n        this.getUserDetail(id);\n        this.getDepartmentTree()\n        this.getRoleList()\n      }\n      this.dialogVisible = true\n    },\n    getDepartmentTree() {\n      sysDepartmentApi.getDepartmentTree().then(response => {\n        this.treeSelectData = response.data;\n      });\n    },\n    getRoleList() {\n      sysRoleApi.getList().then(response => {\n        this.roleOptions = response.data;\n        console.log(this.roleOptions)\n      });\n    },\n    submitAddForm() {\n      console.log(\"form...\")\n      console.log(this.form.departmentId)\n      console.log(this.departmentName)\n      this.$refs.sysUserForm.validate((valid) => {\n        if (valid) {\n          console.log('submit!')\n          this.addUser()\n          // this.$emit(\"getList\")\n        } else {\n          console.log('error submit!!')\n          return false\n        }\n      });\n    },\n    submitUpdateForm() {\n      this.$refs.sysUserForm.validate((valid) => {\n        if (valid) {\n          console.log('submit!')\n          this.updateUser()\n          // this.$emit(\"getList\")\n        } else {\n          console.log('error submit!!')\n          return false\n        }\n      });\n    },\n    getUserDetail(id) {\n      sysUserApi.detail(id).then(response => {\n        if (response.code === 200) {\n          this.form = response.data;\n          if (this.isDetail) {\n            this.form.roleId = response.data.roleName\n          }\n          this.departmentName = response.data.departmentName\n        }\n      });\n    },\n    addUser() {\n      console.log(this.form)\n      const addParam = {\n        username: this.form.username,\n        nickname: this.form.nickname,\n        phone: this.form.phone,\n        password: this.form.password,\n        remark: this.form.remark,\n        state: this.form.state,\n        departmentId: this.form.departmentId,\n        roleId: this.form.roleId\n      }\n      sysUserApi.add(addParam).then(response => {\n        if (response.code === 200) {\n          this.restForm();\n          this.$message({\n            message: '保存系统用户成功',\n            type: 'success'\n          })\n          this.$emit('change')\n        }\n      })\n    },\n    updateUser() {\n      const updateParam = {\n        id: this.updateId,\n        nickname: this.form.nickname,\n        phone: this.form.phone,\n        remark: this.form.remark,\n        state: this.form.state,\n        departmentId: this.form.departmentId,\n        roleId: this.form.roleId\n      }\n      sysUserApi.update(updateParam).then(response => {\n        if (response.code === 200) {\n          this.restForm();\n          this.$message({\n            message: '修改系统用户成功',\n            type: 'success'\n          })\n          this.$emit('change')\n        }\n      })\n    },\n    restForm() {\n      this.$refs.sysUserForm.resetFields()\n      this.dialogVisible = false\n    }\n  }\n}\n",null]}