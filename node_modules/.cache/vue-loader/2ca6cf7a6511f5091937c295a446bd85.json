{"remainingRequest":"D:\\Desktop\\pagepro\\lsying\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\Desktop\\pagepro\\lsying\\src\\views\\system\\sys-user\\components\\sys-user-head.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\Desktop\\pagepro\\lsying\\src\\views\\system\\sys-user\\components\\sys-user-head.vue","mtime":1609569561000},{"path":"D:\\Desktop\\pagepro\\lsying\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"D:\\Desktop\\pagepro\\lsying\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\Desktop\\pagepro\\lsying\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport sysUserApi from '@/api/system/sys-user-api'\nimport uploadApi from '@/api/system/upload-api'\n\nexport default {\n  name: 'SysUserHead',\n  data() {\n    return {\n      dialogVisible: false,\n      id: null,\n      imageUrl: null,\n      uploadFileList: []\n    }\n  },\n  created() {\n\n  },\n  watch: {\n    dialogVisible() {\n      if (!this.dialogVisible) {\n        this.uploadFileList = []\n      }\n    }\n  },\n  methods: {\n    handle(id, head) {\n      this.id = id;\n      this.imageUrl = head;\n      console.log(this.id);\n      console.log(this.imageUrl);\n      this.dialogVisible = true;\n    },\n    handleChange(file, fileList) {\n      // 将最后一个选择的文件赋值给文件列表\n      if (fileList && fileList.length > 1) {\n        fileList = [file]\n      }\n      this.uploadFileList = fileList\n      this.imageUrl = URL.createObjectURL(file.raw);\n    },\n    handleError() {\n      this.$message({\n        message: '上传错误',\n        type: 'error'\n      })\n    },\n    handleBeforeUpload(file) {\n      const isLt2M = file.size / 1024 / 1024 < 2\n      if (!isLt2M) {\n        this.$message.error('头像大小不能超过 2MB!')\n      }\n      return isLt2M\n    },\n    submitForm() {\n      if (this.uploadFileList.length === 0) {\n        this.$message({\n          message: '请选择文件',\n          type: 'error'\n        })\n      }\n      this.$nextTick(() => {\n        this.$refs.upload.submit()\n      })\n    },\n    resetForm() {\n      this.dialogVisible = false\n      this.uploadFileList = []\n      this.$nextTick(() => {\n        this.$refs.upload.clearFiles()\n      })\n    },\n    handleUpload(param) {\n      const formData = new FormData()\n      formData.append(\"file\", param.file)\n      formData.append(\"type\", 'head')\n      // 文件上传后，调用修改用户头像方法\n      uploadApi.upload(formData).then(response => {\n        if (response.code === 200) {\n          this.imageUrl = response.data\n        } else {\n          throw response.message\n        }\n      }).then(() => {\n        // 修改头像\n        sysUserApi.uploadHead({\n          id: this.id,\n          head: this.imageUrl\n        }).then(response => {\n          if (response && response.code === 200) {\n            this.$message({\n              message: '上传头像成功',\n              type: 'success'\n            })\n            this.resetForm()\n            this.$emit('change')\n          }\n        })\n      })\n    }\n  }\n}\n",null]}